// Loan Management System Schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

//////////////////////////////////////////////////////
// ENUM
//////////////////////////////////////////////////////

enum Role {
  ADMIN
  PEMINJAM
}

enum LoanStatus {
  DIPINJAM
  DIKEMBALIKAN
  TERLAMBAT
}

//////////////////////////////////////////////////////
// USER
// Admin & Peminjam berada di satu tabel
//////////////////////////////////////////////////////

model User {
  id        String   @id @default(uuid())
  nama      String
  email     String   @unique
  password  String
  role      Role

  // Relasi
  loansAsPeminjam Loan[] @relation("PeminjamLoan")
  loansAsAdmin    Loan[] @relation("AdminLoan")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Index
  @@index([role])
}

//////////////////////////////////////////////////////
// BARANG
//////////////////////////////////////////////////////

model Barang {
  id          String   @id @default(uuid())
  kodeBarang  String   @unique
  namaBarang  String
  kondisi     String
  stok        Int

  loans       Loan[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Index untuk pencarian
  @@index([namaBarang])
}

//////////////////////////////////////////////////////
// LOAN (PEMINJAMAN)
//////////////////////////////////////////////////////

model Loan {
  id             String     @id @default(uuid())
  tanggalPinjam  DateTime   @default(now())
  tanggalKembali DateTime?
  status         LoanStatus

  // Foreign Keys
  peminjamId String
  adminId    String
  barangId   String

  // Relations
  peminjam User   @relation("PeminjamLoan", fields: [peminjamId], references: [id])
  admin    User   @relation("AdminLoan", fields: [adminId], references: [id])
  barang   Barang @relation(fields: [barangId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Index (KRUSIAL)
  @@index([peminjamId])
  @@index([adminId])
  @@index([barangId])
  @@index([status])
}                                                    